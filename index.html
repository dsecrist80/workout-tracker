<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Workout Logger</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
        import { getFirestore, collection, getDocs, setDoc, doc } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-firestore.js";
        
        const firebaseConfig = {
            apiKey: "AIzaSyC_nkyWikwTCHDIBOvpXkEvk7Cfl8w5GLE",
            authDomain: "workout-tracker-e57d4.firebaseapp.com",
            projectId: "workout-tracker-e57d4",
            storageBucket: "workout-tracker-e57d4.firebasestorage.app",
            messagingSenderId: "20708564104",
            appId: "1:20708564104:web:e7457b6f3fc63cd271933d"
        };
        
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        
        window.db = db;
        window.dbCollection = collection;
        window.dbGetDocs = getDocs;
        window.dbSetDoc = setDoc;
        window.dbDoc = doc;
        window.firebaseReady = true;
        window.dispatchEvent(new Event('firebaseReady'));
    </script>
    
    <script type="text/babel">
        const { useState, useEffect } = React;

        function WorkoutTracker() {
            const [ready, setReady] = useState(false);
            const [exercises, setExercises] = useState([]);

            useEffect(() => {
                const init = () => {
                    if (window.firebaseReady) {
                        setReady(true);
                        loadExercises();
                    }
                };
                
                if (window.firebaseReady) {
                    init();
                } else {
                    window.addEventListener('firebaseReady', init);
                }
            }, []);

            const loadExercises = async () => {
                try {
                    const snap = await window.dbGetDocs(window.dbCollection(window.db, 'exercises'));
                    if (!snap.empty) {
                        snap.forEach(d => {
                            if (d.data().items) setExercises(d.data().items);
                        });
                    } else {
                        loadPresets();
                    }
                } catch(e) {
                    console.error(e);
                    loadPresets();
                }
            };

            const loadPresets = async () => {
                const presets = [
                    { id: 1, name: 'Barbell Squat', type: 'compound_lower', axial: true, prim: ['Quads', 'Glutes'], sec: ['Hams'] },
                    { id: 2, name: 'Bench Press', type: 'compound_upper', axial: false, prim: ['Chest'], sec: ['Tri', 'Shoulders'] },
                    { id: 3, name: 'Deadlift', type: 'compound_lower', axial: true, prim: ['Hams', 'LowBack', 'Glutes'], sec: [] }
                ];
                setExercises(presets);
                
                try {
                    await window.dbSetDoc(window.dbDoc(window.db, 'exercises', 'data'), { items: presets });
                } catch(e) {
                    console.error(e);
                }
            };

            if (!ready) {
                return (
                    <div className="min-h-screen bg-slate-900 flex items-center justify-center">
                        <div className="text-white text-2xl">Loading...</div>
                    </div>
                );
            }

            return (
                <div className="min-h-screen bg-gradient-to-br from-slate-900 to-slate-800 p-4">
                    <div className="max-w-4xl mx-auto">
                        <div className="bg-white rounded-lg shadow-xl p-6">
                            <h1 className="text-3xl font-bold mb-6">Workout Tracker</h1>
                            
                            <div className="mb-6">
                                <h2 className="text-xl font-bold mb-4">Exercises ({exercises.length})</h2>
                                {exercises.map(ex => (
                                    <div key={ex.id} className="p-3 border rounded mb-2">
                                        <div className="font-semibold">{ex.name}</div>
                                        <div className="text-sm text-gray-600">{ex.prim.join(', ')}</div>
                                    </div>
                                ))}
                            </div>
                            
                            <button 
                                onClick={loadPresets}
                                className="bg-blue-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-blue-700"
                            >
                                Reload Presets
                            </button>
                            
                            <div className="mt-6 p-4 bg-green-50 border border-green-200 rounded">
                                <div className="font-semibold text-green-900">âœ“ Firebase Connected</div>
                                <div className="text-sm text-green-700">Data syncs automatically across devices</div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        ReactDOM.render(<WorkoutTracker />, document.getElementById('root'));
    </script>
</body>
</html>
